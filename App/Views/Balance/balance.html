{% extends "base.html" %}

{% block title %}
Bilans
{% endblock %}

{% block footer %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<script src="https://unpkg.com/chart.js-plugin-labels-dv/dist/chartjs-plugin-labels.min.js"></script>
<script src="/js/pieChart.js"></script>
{% endblock %}


{% block body %}
<main>
  <div class="container col-xl-10 col-xxl-8 px-4 py-5">
    <div class="p-5 mb-4 bg-body rounded-3">
      <div class="position-relative">
        <button type="button" class="position-absolute top-0 end-0 btn btn-primary dropdown-toggle"
          data-bs-toggle="dropdown" aria-expanded="false">
          Zmień okres
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item">Bieżący miesiąc</a></li>
          <li><a class="dropdown-item">Poprzedni miesiąc</a></li>
          <li><a class="dropdown-item">Bieżący rok</a></li>
          <li><a class="dropdown-item">Niestandardowy</a></li>
        </ul>

        <h1 class="m-0 pb-4 pb-md-5 lh-1">Bilans za okres ...</h1>
      </div>
      <div class="container">
        <div class="row row-cols-2">
          <div class="col chartBox">
            <canvas id="incomesChart"></canvas>
          </div>
          <div class="col chartBox">
            <canvas id="expensesChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="p-5 mb-4 bg-body rounded-3">
      <h2 class="m-0 pb-4 pb-md-5 lh-1">Przychody</h2>
      <table class="table table-striped table-hover table-sm">
        <thead>
          <tr>
            <th scope="col">Kategoria</th>
            <th class="w-25" scope="col">Wartość</th>
          </tr>
        </thead>

        <tbody class="table-group-divider">
          </tr>
          {% set total_income = 0.0 %}
          {% for income_category in income_categories_totals %}
          {% set total_income = total_income + income_category.sum %}
          <tr class="income">
            <td><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-chevron-down" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                  d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
              </svg>{{income_category.category}}</td>
            <td>{{income_category.sum|number_format(2, '.', '')}}</td>
          </tr>

          <!-- <tr class="d-none"> -->
          <tr>
            <td colspan="2">
              <table class="table mb-0 border border-black">
                <thead>
                  <tr>
                    <th class="w-25" scope="col">Data</th>
                    <th scope="col">Komentarz</th>
                    <th class="w-25" scope="col">Wartość</th>
                  </tr>
                </thead>

                <tbody class="table-group-divider">
                  {% for income in incomes %}
                  {% if income.category == income_category.category %}
                  <tr>
                    <td>{{ income.date }}</td>
                    <td>{{ income.comment }}</td>
                    <td>{{ income.value|number_format(2, '.', '') }}</td>
                  </tr>
                  {% endif %}
                  {% endfor %}
                </tbody>
              </table>
            </td>
          </tr>
          {% endfor %}
        </tbody>

        <tfoot class="table-group-divider">
          <tr>
            <td>Razem</td>
            <td>{{ total_income|number_format(2, '.', '') }}</td>
          </tr>
        </tfoot>
      </table>

    </div>


    <div class="p-5 mb-4 bg-body rounded-3">
      <h2 class="m-0 pb-4 pb-md-5 lh-1">Wydatki</h2>
      <table class="table table-striped table-hover table-sm mb-4">
        <thead>
          <tr>
            <th scope="col">Kategoria</th>
            <th scope="col" style="width: 25%">Wartość</th>
          </tr>
        </thead>

        <tbody class="table-group-divider">
          {% set total_expense = 0.0 %}
          {% for expense_category in expense_categories_totals %}
          {% set total_expense = total_expense + expense_category.sum %}
          <tr class="expense">
            <td>
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-chevron-down" viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                  d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z" />
              </svg>
              {{ expense_category.category }}
            </td>
            <td>{{ expense_category.sum|number_format(2, '.', '') }}</td>
          </tr>

          <!-- <tr class="d-none"> -->
          <tr>
            <td colspan="2">
              <table class="table mb-0 border border-black">
                <thead>
                  <tr>
                    <th class="w-25" scope="col">Data</th>
                    <th scope="col">Komentarz</th>
                    <th class="w-25" scope="col">Wartość</th>
                  </tr>
                </thead>

                <tbody class="table-group-divider">
                  {% for expense in expenses %}
                  {% if expense.category == expense_category.category %}
                  <tr>
                    <td>{{ expense.date }}</td>
                    <td>{{ expense.comment }}</td>
                    <td>{{ expense.value|number_format(2, '.', '') }}</td>
                  </tr>
                  {% endif %}
                  {% endfor %}
                </tbody>
              </table>
            </td>
          </tr>
          {% endfor %}
        </tbody>

        <tfoot class="table-group-divider">
          <tr>
            <td>Razem</td>
            <td>{{ total_expense|number_format(2, '.', '') }}</td>
          </tr>
        </tfoot>
      </table>
      <a href="/" class="w-100 btn btn-lg btn-outline-primary">
        Powrót do menu głównego
      </a>
    </div>
  </div>
</main>
{% endblock %}